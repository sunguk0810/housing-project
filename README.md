# Housing Project

> 서울/경기/인천 맞벌이 신혼부부를 위한 데이터 기반 주거지 분석 안내 서비스

**현재 상태** — 기준일 2026-02-17: M1~M3 완료, M4(Polish + Ship) 진행 중

---

## 프로젝트 소개

맞벌이 신혼부부가 예산 범위 내에서 통근 시간, 보육 인프라, 치안 수준을 동시에 비교하기는 현실적으로 어렵습니다. 공공 데이터가 산재해 있고, 두 직장의 통근 경로를 함께 고려할 수 있는 도구가 부족합니다. 본 서비스는 공공/정식 API 데이터를 통합하여 이 문제를 해결합니다.

**핵심 기능**

- 역산 예산 계산: 소득 대비 적정 주거비를 역산하여 탐색 범위 설정
- 2직장 통근 분석: 두 직장의 통근 시간·경로를 동시에 산출
- 인프라 통합 평가: 보육·교육·치안·생활 인프라를 권역별로 정량 평가
- 설명 가능한 분석 결과 리포트: 상위 10개 권역에 대해 점수 산출 근거를 투명하게 제공

**Non-goals**

- 부동산 중개·알선 행위를 하지 않습니다
- 대출 승인 여부를 판단하지 않습니다
- 매물을 직접 제공하지 않습니다

> 본 서비스는 정보 제공 목적이며, 거래나 승인을 보장하지 않습니다.

상세 요구사항: [`docs/PHASE0_ground.md`](docs/PHASE0_ground.md) 참조

---

## 작동 원리

사용자가 소득과 보유 현금만 입력하면, 서비스가 **① 구매력 역산 → ② 6차원 점수 평가 → ③ 순위 결정**을 자동으로 수행합니다.

```
┌─────────────┐     ┌──────────────┐     ┌──────────────┐     ┌────────────┐
│  사용자 입력  │ ──→ │ 구매력 역산   │ ──→ │ 6차원 점수   │ ──→ │  Top 10    │
│ 현금·소득·직장│     │ 최대 금액 산출 │     │ 가중합 산출   │     │ 결과 리포트 │
└─────────────┘     └──────────────┘     └──────────────┘     └────────────┘
```

### 1단계: 최대 구매력 역산

복잡한 대출 규제를 사용자가 직접 계산할 필요 없이, **소득·현금·주거 상태**만 입력하면 규제를 자동 적용하여 "내가 살 수 있는 최대 금액"을 산출합니다.

| 경로 | 대상 | 핵심 규제 | 금리 |
| --- | --- | --- | --- |
| 은행 주담대 | 매매 (기본) | DSR 40% + LTV + 구간별 대출한도 | 4.5% |
| 보금자리론 | 매매 (6억 이하) | 신DTI 60% + 최대 4.2억 한도 | 4.0% |
| 전세대출 | 전세 | DTI 40% + 보증비율 80% | 3.5% |

**계산 흐름** — 예: 현금 2억, 연소득 8,000만원, 생애최초 → 은행 주담대

1. **소득 기반 한도**: 연소득 × DSR 40% = 연 3,200만원 상환 가능 → 원리금균등 30년 역산 → 약 5.7억
2. **담보 기반 한도**: 현금 2억 ÷ (1-LTV 70%) × 70% = 약 4.7억
3. **둘 중 작은 값** 선택 → 4.7억
4. **구간별 한도 캡** 적용 (15억 이하 → 6억 한도) → 최종 대출 4.7억
5. **최대 구매 가능 금액** = 현금 2억 + 대출 4.7억 = **6.7억**

<details>
<summary>상세 계산 로직 (수식 & 상수)</summary>

#### 규제 상수 (2025.10.15 주택시장 안정화 대책 기준, 규제지역 가정)

**은행 주담대 — DSR 40%**

| 주거 상태 | LTV | DSR | 대출 기간 |
| --- | --- | --- | --- |
| 생애최초 | 70% | 40% | 30년 |
| 무주택 | 40% | 40% | 30년 |
| 유주택 | 0% (대출 불가) | — | — |

구간별 대출한도 캡:

| 매매가 구간 | 대출 한도 |
| --- | --- |
| ≤ 15억 | 6억 |
| ≤ 25억 | 4억 |
| > 25억 | 2억 |

**보금자리론 — 신DTI 60%**

| 주거 상태 | LTV | DTI | 대출 한도 | 매매가 상한 |
| --- | --- | --- | --- | --- |
| 생애최초 | 70% | 60% | 4.2억 | 6억 |
| 무주택 | 70% | 60% | 3.6억 | 6억 |
| 유주택 | 자격 없음 | — | — | — |

**전세대출 — DTI 40%**

| 항목 | 값 |
| --- | --- |
| 보증비율 | 80% |
| DTI | 40% |
| 상환 방식 | 만기일시상환 (이자만 납부) |
| 유주택자 한도 | 2억 |

#### 핵심 수식

```
# 원리금균등상환 역산 (은행 주담대 / 보금자리론)
최대대출 = 월상환가능액 × (1 - (1+r)^(-n)) / r
  r = 연이율 / 12,  n = 대출기간(년) × 12

# 소득 기반 한도
연상환가능액 = 연소득 × DSR비율 - 기존대출 월상환액 × 12

# 담보 기반 한도
최대대출(LTV) = 보유현금 × LTV / (1 - LTV)

# 최종 = min(소득기반, 담보기반, 구간별캡)
최대구매가 = 보유현금 + 최종대출
```

</details>

### 2단계: 6차원 점수 평가

구매 가능 범위 내 단지들을 **6가지 차원**으로 평가합니다. 각 차원은 0~1로 정규화되어 공정하게 비교됩니다.

| 차원 | 평가 기준 | 점수가 높으면 |
| --- | --- | --- |
| 예산 적합도 | 최대 금액 대비 가격 활용률 | 예산의 50~85%를 효율적으로 사용 |
| 통근시간 | 두 직장 중 더 긴 통근시간 | 60분 이내로 짧을수록 |
| 보육시설 | 반경 800m 어린이집 수 | 주변 보육시설이 많을수록 |
| 안전 환경 | 범죄율 + CCTV + 대피시설 종합 | 치안 인프라가 좋을수록 |
| 학군 수준 | 학업 성취도 점수 | 인근 학교 성적이 높을수록 |
| 단지 규모 | 총 세대수 | 대단지일수록 (관리·인프라 이점) |

**가중치 프로필** — 사용자가 선택한 우선순위에 따라 자동 조정:

| 프로필 | 예산 | 통근 | 보육 | 안전 | 학군 | 규모 |
| --- | --- | --- | --- | --- | --- | --- |
| 균형 | 28% | 24% | 14% | 14% | 12% | 8% |
| 예산 중심 | 38% | 20% | 12% | 12% | 10% | 8% |
| 통근 중심 | 20% | 38% | 12% | 12% | 10% | 8% |
| 단지 중심 | 20% | 18% | 12% | 12% | 13% | 25% |
| 가성비 | 0% | 30% | 18% | 18% | 15% | 19% |

<details>
<summary>정규화 공식 상세</summary>

```
# 예산 적합도: 활용률 곡선 (sweet spot = 50~85%)
ratio = 아파트가격 / 최대금액
  0~50%  → 0.30 + ratio × 1.1      (저활용: 더 좋은 집 가능)
  50~85% → 0.85 + (ratio-0.5)/0.35 × 0.15  (최적 구간)
  85~100%→ 1.0 - (ratio-0.85)/0.15 × 0.3   (빠듯한 예산)

# 통근시간: 60분 기준 선형
score = max(0, (60 - max(통근1, 통근2)) / 60)

# 보육시설: 제곱근 체감
score = min(√(800m내 어린이집수 / 30), 1)

# 안전 환경: 3개 하위지표 가중합
crime_norm   = (10 - 범죄수준) / 9
cctv_norm    = min(CCTV밀도 / 5, 1)
shelter_norm = min(대피시설수, 10) / 10
safety = 0.5 × crime + 0.3 × cctv + 0.2 × shelter

# 학군: 단순 비율
score = 성취도점수 / 100

# 단지 규모: 로그 보간 (규제 기준점 기반)
  50세대 → 0.05 | 300세대 → 0.30 | 1000세대 → 0.70 | 5000세대 → 1.00
  구간 사이는 로그 스케일로 보간
```

</details>

### 3단계: 최종 순위 결정

```
최종 점수 = 100 × Σ(가중치 × 차원 점수)
```

모든 단지를 최종 점수 순으로 정렬하여 **상위 10개**를 선정합니다. "가성비" 프로필에서는 가격대별 다양성을 보장하기 위해 프리미엄(30%)·중간(40%)·실속(30%) 비율로 재배치합니다.

결과에는 각 단지의 **선정 이유**("예산 적합도 85% + 통근시간 양호")와 **약점**("보육시설이 적은 편")을 함께 제공하여 투명한 의사결정을 돕습니다.

---

## 기술 스택

| 영역          | 기술                                   |
| ------------- | -------------------------------------- |
| 프레임워크    | Next.js 16.x (App Router)              |
| 언어          | TypeScript (strict 모드)               |
| UI            | React 19 + Tailwind CSS v4 + shadcn/ui |
| DB            | PostgreSQL 16 + PostGIS 3.4            |
| 캐시          | Redis 7                                |
| 인프라        | Docker Compose                         |
| 패키지 매니저 | pnpm                                   |
| 코드 품질     | ESLint 9 + Prettier + Husky            |

---

## 사전 요구사항

- Node.js >= 20
- pnpm >= 9
- Docker Desktop
- Git

---

## 시작하기

```bash
git clone <repository-url>
cd housing-project

# 환경변수 설정
cp .env.example .env
# .env 파일에서 공공 API 키를 직접 발급하여 입력 (PostgreSQL/Redis 기본값은 제공됨)

# 의존성 설치
pnpm install

# Docker 컨테이너 실행 (PostgreSQL + Redis)
docker compose up -d

# DB 마이그레이션
bash db/migrate.sh

# 개발 서버 실행
pnpm dev
```

> **migrate.sh 주의사항**: 초기 세팅 1회 실행 기준입니다. 재실행 시 `CREATE TABLE` 충돌이 발생합니다.
> 재초기화가 필요하면 `docker compose down -v` 후 `docker compose up -d` → `bash db/migrate.sh`를 수행하세요.

---

## 프로젝트 구조

```
housing-project/
├── src/
│   ├── app/            # Next.js App Router (라우트 + 페이지)
│   ├── components/     # UI 컴포넌트
│   │   ├── card/       # PropertyCard 등
│   │   ├── compare/    # 비교 페이지 컴포넌트
│   │   ├── complex/    # 단지 상세 컴포넌트
│   │   ├── feedback/   # Skeleton, Toast 등
│   │   ├── input/      # StepWizard, 입력 폼
│   │   ├── layout/     # CompareBar, Header 등
│   │   ├── map/        # KakaoMap, BottomSheet
│   │   ├── score/      # CircularGauge, ScoreBar
│   │   ├── trust/      # DataSourceTag, 면책 고지
│   │   └── ui/         # shadcn/ui 기반 공통 UI
│   ├── contexts/       # CompareContext 등 전역 상태
│   ├── db/             # Drizzle ORM 스키마 + 커넥션
│   ├── etl/            # ETL 어댑터 + 러너
│   ├── hooks/          # Custom Hooks
│   ├── lib/            # 유틸리티, 엔진, 포매터
│   ├── styles/         # 디자인 토큰
│   └── types/          # TypeScript 타입 정의
├── db/
│   ├── schema.sql      # DB 스키마 (PHASE1 S2 파생)
│   └── migrate.sh      # 마이그레이션 스크립트
├── docs/               # PHASE 문서 + Plan 기록
├── scripts/            # 유틸리티 스크립트
├── compose.yml         # Docker (PostgreSQL + Redis)
└── .env.example        # 환경변수 템플릿
```

---

## 주요 명령어

| 명령어                   | 설명                          |
| ------------------------ | ----------------------------- |
| `pnpm dev`               | 개발 서버 실행                |
| `pnpm build`             | 프로덕션 빌드                 |
| `pnpm start`             | 프로덕션 서버 실행            |
| `pnpm lint`              | ESLint 검사                   |
| `pnpm format`            | Prettier 포맷팅 적용          |
| `pnpm format:check`      | Prettier 포맷팅 검사          |
| `pnpm prepare`           | Husky Git hooks 설치          |
| `docker compose up -d`   | Docker 컨테이너 실행          |
| `docker compose down`    | Docker 컨테이너 중지          |
| `docker compose down -v` | Docker 컨테이너 + 볼륨 초기화 |
| `bash db/migrate.sh`     | DB 마이그레이션 실행          |

---

## 개발 워크플로

### 언어 규칙

| 대상                  | 언어   |
| --------------------- | ------ |
| 문서 (`.md`)          | 한국어 |
| 커밋 메시지           | 한국어 |
| 코드 (변수명, 함수명) | 영어   |
| 주석                  | 영어   |

### 커밋 메시지 형식

```
<type>(<scope>): <subject>

<detailed description>

- 변경 사항 1
- 변경 사항 2
```

- `<type>`: `feat | fix | docs | refactor | test | chore`
- `<scope>`: 변경 대상 (예: `phase2`, `plan`)
- `<subject>`: 한줄 요약 (50자 이내)

### SoT 보호 원칙

| SoT 범위                                 | 유일한 수정 지점        |
| ---------------------------------------- | ----------------------- |
| FR/NFR, KPI 정의/게이트, 법무 체크리스트 | `docs/PHASE0_ground.md` |
| DB 스키마(S2), 스코어링 로직(S4)         | `docs/PHASE1_design.md` |

다른 문서에서는 해당 PHASE 문서를 **참조만** 합니다 (중복 정의 금지).

---

## 문서 안내

| 문서                                                     | 설명                                                                     |
| -------------------------------------------------------- | ------------------------------------------------------------------------ |
| [`docs/PHASE0_ground.md`](docs/PHASE0_ground.md)         | 요구사항, KPI, 법무 체크리스트                                           |
| [`docs/PHASE1_design.md`](docs/PHASE1_design.md)         | DB 스키마, 스코어링 로직, 디자인 시스템                                  |
| [`docs/PHASE2_build.md`](docs/PHASE2_build.md)           | 구현 마일스톤 (M1~M4)                                                    |
| [`docs/PHASE3_verify.md`](docs/PHASE3_verify.md)         | 테스트, 성능, 보안 검증                                                  |
| [`docs/PHASE4_ship_learn.md`](docs/PHASE4_ship_learn.md) | 배포, 운영, 회고                                                         |
| [`docs/etl-architecture.md`](docs/etl-architecture.md)   | ETL 파이프라인 아키텍처 (데이터 소스, 흐름도, 실행 방법)                 |
| [`docs/plan/`](docs/plan/)                               | Plan Execute 기록 (인덱스: [`docs/plan/README.md`](docs/plan/README.md)) |
| [`docs/design-system/`](docs/design-system/)             | 디자인 시스템 명세 + 쇼케이스                                            |
| [`CLAUDE.md`](CLAUDE.md)                                 | Claude Code 에이전트 지침                                                |
| [`AGENTS.md`](AGENTS.md)                                 | Codex 에이전트 지침                                                      |

---

## 컴플라이언스

- 본 서비스는 **정보 제공 목적**이며, 부동산 중개·알선을 하지 않습니다
- **개인정보 비저장** (NFR-1): DB, 로그, APM 전체 파이프라인에 PII를 저장하지 않습니다
- **크롤링 금지** (NFR-4): 공공 API, 정식 API만 사용합니다
- **출처 표기 필수**: 데이터 표시 시 출처와 기준일을 함께 표기합니다
- 금지 문구 및 상세 법무 체크리스트: [`docs/PHASE0_ground.md`](docs/PHASE0_ground.md) 참조

---

## 주요 기능

- **5단계 입력 퍼널**: 주거 유형 → 직장 위치 → 소득 정보 → 지출·가중치 → 분석 실행
- **분석 결과 지도/리스트**: 카카오맵 기반 지도 뷰 + 스크롤 리스트 (정렬/필터)
- **단지 상세 분석**: 5차원(예산/통근/보육/안전/학군) 점수 + 가격 이력 + 인프라 정보
- **단지 비교**: 최대 3개 단지 병렬 비교 (레이더 차트 + 테이블)
- **이벤트 트래킹**: GTM/GA4 연동 (10+ 이벤트 자동 추적)
- **컴플라이언스**: 5접점 면책 고지, 출처 표기, 금지 문구 자동 검사

## 현재 상태

> 기준일 2026-02-17 기준

**M1 (Foundation) 완료**

- Next.js 16.x + TypeScript strict 모드 초기 설정
- PostgreSQL 16 + PostGIS 3.4 Docker 인프라 구축
- DB 스키마 마이그레이션 + S7 디자인 토큰 Tailwind v4 매핑
- ESLint 9 + Prettier + Husky pre-commit 게이트

**M2 (Data + Engine) 완료**

- Drizzle ORM 스키마 + PostGIS customType + 커넥션 풀
- Mock 데이터 755건 + Seed 스크립트
- 예산/통근/보육/안전/학군 스코어링 엔진
- ETL 어댑터 5종 + Zod 검증 + API 라우트 3종

**M3 (Frontend) 완료**

- 5단계 입력 퍼널 (StepWizard + 동의 UI)
- 결과 페이지 (지도 + 리스트 + 정렬)
- 단지 상세 페이지 (/complex/[id])
- 비교 페이지 (/compare) — 레이더 차트 + 비교 테이블
- 이벤트 트래킹 (GTM/GA4) + 면책/컴플라이언스 UI

**다음 단계**: M4 (Polish + Ship)
